#!/bin/bash

# Find all staged C++ source and header files (you can modify this pattern)
files=$(git diff --cached --name-only --diff-filter=AM | grep -E '\.cpp$|\.h$')

# If there are no relevant files, exit early
if [ -z "$files" ]; then
    exit 0
fi

# Run clang-format on all staged files
echo "Running clang-format on staged files..."
for file in $files; do
    clang-format -i "$file"  # Format the file in place
    git add "$file"          # Re-add the formatted file to the staging area
done

echo "clang-format done."

# Optionally: Run tests or other checks here, like 'make lint'

exit 0
